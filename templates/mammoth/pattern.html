<!DOCTYPE html>

{% extends 'mammoth/base.html' %}
{% load staticfiles %}

{% block style_block %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/pattern_style.css' %}" />
    <link rel="stylesheet" type="text/css" href="//code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css" />
    
{% endblock %}

{% block title_block %}
    {{ pattern_title }}
{% endblock %}

{% block body_block %}
   
    <h2>{{ pattern_title }}</h2>
    <div>
         <!-- add something to make pattern looks better -->
        <div class = "pattern_image">
            <img src="{{ pattern.picture.url }}">
        </div>
        
        <div><h2 >Average Score: {{ AvgRate | floatformat:1 }}</h2></div>
        <x-avgstar-bar value="{{ AvgRate | floatformat:0}}"></x-avgstar-bar>
        <script src="{% static 'js/averageRate.js' %}"></script>
        <h2>Description</h2>
        <div class="pattern_description">{{ pattern.description }}</div>
        
        <div style="clear: both;">
            <h2>Post Author</h2>
            <span style="font-size: 18px;">{{ pattern.author.username}} </span>
        </div>
        
        
       
    </div>
    
    </br>
    <div class="comment_submit">

    {% if user.is_authenticated %}
        <h3>COMMENT Submit</h3>
        <form action="{% url 'mammoth:comment' %}" method="POST">
            {% csrf_token %}
            <x-star-bar id = "rateBar"></x-star-bar>
            <script src="{% static 'js/starRate.js' %}"></script>
            <textarea name="text" id="" cols="30" rows="10"></textarea>
            <input type="hidden" name="object_id" value="{{pattern.pk}}">
            <input type="hidden" name="content_type" value = "pattern">
            <input type="hidden" name="rate" value = "0" id = "rateInput"> 
            <!-- ===================Rate event Script===================== -->
            {% comment %} the value of rate will use javascript {% endcomment %}
            <script>
                rateBar.addEventListener('rated',() =>{
                    rateInput.value = rateBar.value;
                    console.log(rateBar.value);
                });
            </script>
            <!-- ===================Rate event Script End.....main===================== -->
            <input type="submit" value="submit">
        </form>
    {% else %}
        <h3>COMMENT Submit</h3>
        <p style="font-size: 20px;">If you want to subit your comment, Please Login first</p>
    {% endif %}
    </div>

    <!-- here will display the comments list for this special type / might be changed with different type of pages-->
    
        <div class="comment_list">
            <h3>Comment List</h3>
        {% for comment in comments %}
<!-- <<<<<<< HEAD -->
        <div class = "comment_block">
            <div>Name: {{comment.user.username}}</div>
            <div>
                <div class = "comment_image">
                    <img src="{{ comment.user.userprofile.picture.url }}">
                </div>
                <div class = "comment_content"><p>{{comment.text}}</p></div>
            </div>
            
            <div class="comment_date">Time: {{comment.comment_time|date:"Y-m-d H:n:s"}}</div>
            <div><span>Rated Score:</span> </div>
            <x-commentstar-bar value="{{comment.comment_rate}}"></x-commentstar-bar>
            
        </div>
        {% empty %}
        <div>There is no comment</div>
        {% endfor %}
    </div>
        <!-- must put at the end of body -->
        <script type="text/javascript" src="{% static 'js/commentRate.js' %}"></script>
{% endblock %}